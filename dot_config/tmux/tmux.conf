# --- Global Settings ---
set -g prefix C-s
unbind C-b
set-option -g update-environment "DISPLAY WAYLAND_DISPLAY SSH_AUTH_SOCK"
set -as terminal-overrides ',*:U8=0'
set-option -wg mouse on
set -ga terminal-features "*:passthrough"

# 1. キーバインドを無効化する「オフモード」の定義
bind -T root F12 \
  set prefix None \;\
  set key-table off \;\
  set status-style "fg=colour245,bg=colour238" \;\
  set status-left "#[fg=black,bg=yellow,bold] REMOTE #[default] " \;\
  refresh-client -S

# 2. 「オフモード」から「オンモード」に戻る設定
bind -T off F12 \
  set -u prefix \;\
  set -u key-table \;\
  set -u status-style \;\
  set -u status-left \;\
  refresh-client -S

# --- Bind-key (Normal Mode) ---
bind -n M-c new-window -c "#{pane_current_path}"
bind -n M-w 'kill-window'
bind -n M-p previous-window
bind -n M-n next-window
bind -n C-PageUP previous-window
bind -n C-PageDOWN next-window

# Prefix + m で移動先セッション名を聞くようにする設定
bind-key m command-prompt -p "send window to session:" "move-window -t '%%':"

# IME設定
bind -n M-[ run-shell "fcitx5-remote -c" \; copy-mode
bind [ run-shell "fcitx5-remote -c" \; copy-mode

# --- ペイン分割 (Prefix + h / v) ---
bind h split-window -v -c "#{pane_current_path}"
bind v split-window -h -c "#{pane_current_path}"

# --- Alt + hjkl でペイン移動 ---
bind -n M-h select-pane -L
bind -n M-j select-pane -D
bind -n M-k select-pane -U
bind -n M-l select-pane -R

# --- ペインのリサイズ ---
bind -r C-h resize-pane -L 1
bind -r C-j resize-pane -D 1
bind -r C-k resize-pane -U 1
bind -r C-l resize-pane -R 1

bind-key -n C-S-Left swap-window -t -1
bind-key -n C-S-Right swap-window -t +1
bind c new-window -c '#{pane_current_path}'
bind-key C command-prompt -p "New Session Name:" "new-session -s '%%'"

# --- Style & Focus (境界線を固定し背景でフォーカスを表現) ---
set -g allow-rename on
set-option -g status-position top
set-option -g status-justify "centre"
set -g renumber-windows on
set -g default-terminal "tmux-256color"
set -ag terminal-overrides ",xterm-256color:RGB"

# 1. 境界線の色を完全に統一（一本の線に見せる）
set -g pane-border-style fg=colour240
set -g pane-active-border-style fg=colour240

# 2. フォーカスが当たっているペインの背景色を少し変える
# 背景が黒系なら、非アクティブを少し暗く(colour234等)設定
setw -g window-active-style bg=terminal
setw -g window-style bg=colour234

# --- ステータスライン ---
set -g status-left '#{prefix_highlight}'
set -g status-right ''
setw -g window-status-format "#W"
setw -g window-status-current-format "#W"
set-option -g status-style fg=white,bg=colour235
set -g window-status-style fg=colour242
set -g window-status-current-style fg=white

# --- Copy Mode (vi) ---
setw -g mode-keys vi
bind-key -T copy-mode-vi 'v' send -X begin-selection
bind-key -T copy-mode-vi 'C-v' send -X rectangle-toggle
bind-key -T copy-mode-vi y send-keys -X copy-pipe-and-cancel "xsel -bi"
bind-key -T copy-mode-vi Enter send-keys -X copy-pipe-and-cancel "xsel -bi"

# --- Plugins ---
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'tmux-plugins/tmux-prefix-highlight'

run '~/.tmux/plugins/tpm/tpm'
